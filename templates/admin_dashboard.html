{% extends "base.html" %}
{% block content %}

<div class="dashboard admin-dashboard">

  <div class="dashboard-header">
    <div>
      <h2>Admin Control Panel</h2>
      <p class="text-secondary">
        Welcome back, <strong>{{ session.user.Admin_Name }}</strong> (ID: {{ session.user.Admin_ID }})
      </p>
    </div>
    <div>
      <a href="/admin/personnel/page" class="btn">Manage Repair Personnel</a>
    </div>
  </div>

  <!-- STATS -->
  <div class="stats-grid">
    <div class="stat-card">
      <h3 id="total">0</h3>
      <p>Total Tickets</p>
    </div>
    <div class="stat-card" style="border-left-color: var(--accent-warning);">
      <h3 id="pending">0</h3>
      <p>Pending</p>
    </div>
    <div class="stat-card" style="border-left-color: var(--accent-info);">
      <h3 id="inprogress">0</h3>
      <p>In Progress</p>
    </div>
    <div class="stat-card" style="border-left-color: var(--accent-success);">
      <h3 id="completed">0</h3>
      <p>Completed</p>
    </div>
  </div>

  <!-- TABLE -->
  <div class="card animate-scale-up">
    <div
      style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:12px; margin-bottom:20px;">
      <h3>All Complaints</h3>

      <div class="filters" style="display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
        <input id="adminSearch" class="search-input" type="search" placeholder="Search ticket # or issue..."
          style="width:250px;" />
        <select id="adminStatus" class="search-input" style="max-width:160px;">
          <option value="">All statuses</option>
          <option value="pending">Pending</option>
          <option value="assigned">Assigned</option>
          <option value="completed">Completed</option>
          <option value="closed">Closed</option>
        </select>
        <button onclick="applyAdminFilters()" class="btn secondary sm">Search</button>
      </div>
    </div>

    <div class="table-responsive">
      <table id="adminTable">
        <thead>
          <tr>
            <th>Ticket</th>
            <th>Resident</th>
            <th>Flat</th>
            <th class="hide-mobile">Personnel ID</th>
            <th>Personnel</th>
            <th>Status</th>
            <th>Issue</th>
            <th>Req Date</th>
            <th class="hide-mobile">Completion Date</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- ASSIGN PERSONNEL MODAL -->
  <div id="assignModal"
    style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.4); z-index:2000; backdrop-filter:blur(4px); align-items:center; justify-content:center;">
    <!-- Note: Added flex centering via inline style script or CSS would be better, but JS controls display:block/none. 
         Ideally we add a class 'modal-open' but we can't change JS. 
         We'll rely on the inner div's margin for now, or add a style block to force centering if possible.
         The JS sets display: block. So we can't use flex in the parent easily without changing JS.
         We will style the inner modal to look good. -->
    <div class="card animate-scale-up" style="margin: 10% auto; max-width:400px; box-shadow: var(--shadow-hover);">
      <h3>Assign Repair Personnel</h3>

      <div class="form-group">
        <label for="personnelSelect">Select Personnel:</label>
        <select id="personnelSelect">
          <option value="">-- Loading personnel --</option>
        </select>
      </div>

      <div style="margin-top:20px; text-align:right; display:flex; justify-content:flex-end; gap:12px;">
        <button onclick="closeAssignModal()" class="btn secondary">Cancel</button>
        <button onclick="submitAssign()" class="btn">Assign</button>
      </div>
    </div>
  </div>

</div>

<script src="/static/js/admin.js"></script>
{% endblock %}