{% extends "base.html" %}
{% block content %}

<div class="dashboard admin-dashboard">

  <h2>Admin Control Panel</h2>
  <div class="admin-header">
    <div style="flex:1;">
      <p class="admin-meta">
        ID: {{ session.user.Admin_ID }} |
        Name: {{ session.user.Admin_Name }}
      </p>
    </div>
    <div style="display:flex; align-items:center; gap:8px;">
      <a href="/admin/personnel/page" class="btn" style="padding:8px 12px;">Manage Repair Personnel</a>
    </div>
  </div>

  <!-- STATS -->
  
  <div class="card-row">
    <div class="stat-card">
      <h3 id="total">0</h3>
      <p>Total Tickets</p>
    </div>
    <div class="stat-card">
      <h3 id="pending">0</h3>
      <p>Pending</p>
    </div>
    <div class="stat-card">
      <h3 id="inprogress">0</h3>
      <p>In Progress</p>
    </div>
    <div class="stat-card">
      <h3 id="completed">0</h3>
      <p>Completed</p>
    </div>
  </div>

  <!-- TABLE -->
  <div class="card">
    <h3>All Complaints</h3>
    <div class="filters" style="display:flex; gap:12px; align-items:center; margin-bottom:12px;">
      <input id="adminSearch" class="search-input" type="search" placeholder="Search ticket # or issue description" />
      <select id="adminStatus" class="search-input" style="max-width:160px;">
        <option value="">All statuses</option>
        <option value="pending">Pending</option>
        <option value="assigned">Assigned</option>
        <option value="completed">Completed</option>
        <option value="closed">Closed</option>
      </select>
      <button onclick="applyAdminFilters()" class="btn" style="width:auto; padding:8px 12px;">Search</button>
    </div>

    <div class="table-responsive">
    <table id="adminTable" class="table-compact">
      <thead>
        <tr>
          <th>Ticket</th>
          <th>Resident</th>
          <th>Flat</th>
          <th class="hide-mobile">Personnel ID</th>
          <th>Personnel</th>
          <th>Status</th>
          <th>Issue</th>
          <th>Req Date</th>
          <th class="hide-mobile">Completion Date</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    </div>
  </div>

  

  <!-- ASSIGN PERSONNEL MODAL -->
  <div id="assignModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000;">
    <div style="background:white; margin:10% auto; padding:30px; border-radius:12px; max-width:400px; box-shadow:0 10px 40px rgba(0,0,0,0.2);">
      <h3>Assign Repair Personnel</h3>
      <label for="personnelSelect">Select Personnel:</label>
      <select id="personnelSelect" style="width:100%; padding:10px; margin:10px 0; border:1px solid #d1d5db; border-radius:6px;">
        <option value="">-- Loading personnel --</option>
      </select>
      <div style="margin-top:20px; text-align:right;">
        <button onclick="closeAssignModal()" style="margin-right:10px; padding:8px 16px; border:1px solid #d1d5db; border-radius:6px; background:#f3f4f6; cursor:pointer;">Cancel</button>
        <button onclick="submitAssign()" style="padding:8px 16px; border:none; border-radius:6px; background:#10b981; color:white; cursor:pointer;">Assign</button>
      </div>
    </div>
  </div>

</div>

<script src="/static/js/admin.js"></script>
{% endblock %}
